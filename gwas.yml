pipeline: imputation and GWAS pipeline for SNP genotyping data

resources:
   conda_path: /home/filippo/anaconda2/bin/
   zanardi: /home/filippo/Dropbox/cursos/berlin2018/Zanardi/Zanardi.py
   plink: ~/Downloads/plink

steps:

  explore_genotypes:
    desc: basic stats on genotypes data
    run:
      - <plink> --sheep --file sheep --freq --out ovis
      - <plink> --sheep --file sheep --missing --out ovis
      - <plink> --sheep --file sheep --hardy --out ovis

  imputation:
    desc: run the imputation of missing genotypes through Zanardi
    run:
      - vim PARAMFILE.txt [edit software paths, data paths, QC_OTHOPT= --bp-space 1]
      - run with and without QC (to show effect of duplicate SNPs)
      - python <zanardi> --beagle4 --plinkqc


  prep_phenotypes:
    desc: prepare phenotype file for GWAS
    run:
      #for sheep data
      - cut -f1,2,5,6 -d' ' <ped_file>  > phenotypes.dat ##'
      - python prep_pheno.py -i phenotypes.dat -o pheno_genabel.dat
      #for rice data
      - cut -d' ' -f1 rice.ped > pops #'
      - paste -d' ' pops phenotypes_rice.txt > temp #'
      - awk 'NR==1 {v=1}{print $2,$1,$3,v}' temp > phenotypes_rice.txt

  prep_genotypes:
    desc: transpose ped/map files
    run: 
      - <plink> --sheep --file sheep --transpose --recode --out transposed_sheep
      - <plink> --sheep --file ~/Dropbox/cursos/berlin2018/Zanardi/OUTPUT/BEAGLE_OUT_IMPUTEDSHEEP_IMPUTED --transpose --recode --out transposed_sheep
      - <plink> --file ~/Dropbox/cursos/berlin2018/Zanardi/OUTPUT/BEAGLE_OUT_IMPUTEDRICE_IMPUTED --transpose --recode --out transposed_rice

  file_conversion:
    desc: convert genotype and phenotype files for GenABEL
    run:
      - Rscript --vanilla convert_GenABEL.R tped_file tfam_file phenotype_data

